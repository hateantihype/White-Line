<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhiteLine - Учет грузовых перевозок</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .logo {
            width: 160px;
            height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        h1, h2 {
            margin-bottom: 15px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }

        .tab.active {
            background-color: #f1c40f;
            color: #333;
        }

        .tab-content {
            display: none;
            padding: 20px;
            background-color: white;
            border-radius: 0 5px 5px 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            background-color: #f1c40f;
            color: #333;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
        }

        button:hover {
            background-color: #f39c12;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .actions {
            display: flex;
            gap: 5px;
        }

        .btn-edit {
            background-color: #f39c12;
            color: white;
        }

        .btn-delete {
            background-color: #e74c3c;
            color: white;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 4px solid #f1c40f;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #f1c40f;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #2ecc71;
            color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: none;
        }

        /* Стили для вкладки "Заказ авто" */
        .bus-catalog {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .bus-slider {
            position: relative;
            overflow: hidden;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .bus-slides {
            display: flex;
            transition: transform 0.5s ease;
        }

        .bus-slide {
            min-width: 100%;
            padding: 20px;
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .bus-image-container {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .bus-image {
            width: 90%;
            max-width: 600px;
            height: 300px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 1px solid #eee;
            transition: transform 0.3s ease;
        }

        .bus-image:hover {
            transform: scale(1.02);
        }

        .bus-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .bus-specs {
            margin-bottom: 15px;
            width: 100%;
            max-width: 500px;
        }

        .bus-spec {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .bus-spec span:first-child {
            font-weight: 600;
            color: #555;
        }

        .bus-spec span:last-child {
            color: #2c3e50;
        }

        .bus-description {
            margin-bottom: 15px;
            color: #666;
            line-height: 1.5;
            max-width: 500px;
        }

        .bus-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f1c40f;
            margin-bottom: 15px;
        }

        .slider-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .slider-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ddd;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .slider-dot.active {
            background-color: #f1c40f;
        }

        .order-form {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                margin-bottom: 5px;
                border-radius: 5px;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .bus-slide {
                padding: 15px;
            }
            
            .bus-image {
                height: 250px;
            }
        }

        @media (max-width: 480px) {
            .bus-image {
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <img src="logo.jpg" alt="WhiteLine Logo">
            </div>
            <div>
                <h1>WhiteLine</h1>
                <p>Грузовые перевозки</p>
            </div>
        </header>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Всего маршрутов</div>
                <div class="stat-value" id="total-routes">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Всего водителей</div>
                <div class="stat-value" id="total-drivers">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Выполнено перевозок</div>
                <div class="stat-value" id="total-shipments">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Общая выплата</div>
                <div class="stat-value" id="total-payments">0 руб.</div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="routes">Маршруты</div>
            <div class="tab" data-tab="drivers">Водители</div>
            <div class="tab" data-tab="shipments">Перевозки</div>
            <div class="tab" data-tab="order-bus">Заказ авто</div>
            <div class="tab" data-tab="reports">Отчеты</div>
        </div>

        <!-- Вкладка Маршруты -->
        <div class="tab-content active" id="routes">
            <h2>Управление маршрутами</h2>
            <form id="route-form">
                <input type="hidden" id="route-id">
                <div class="form-group">
                    <label for="route-name">Название маршрута</label>
                    <input type="text" id="route-name" required>
                </div>
                <div class="form-group">
                    <label for="route-distance">Дальность (км)</label>
                    <input type="number" id="route-distance" min="1" required>
                </div>
                <div class="form-group">
                    <label for="route-days">Количество дней в пути</label>
                    <input type="number" id="route-days" min="1" required>
                </div>
                <div class="form-group">
                    <label for="route-payment">Оплата водителю (руб.)</label>
                    <input type="number" id="route-payment" min="1" required>
                </div>
                <button type="submit" id="route-submit">Добавить маршрут</button>
                <button type="button" id="route-cancel" style="display: none; background-color: #95a5a6;">Отмена</button>
            </form>

            <table id="routes-table">
                <thead>
                    <tr>
                        <th>Код</th>
                        <th>Название</th>
                        <th>Дальность (км)</th>
                        <th>Дни в пути</th>
                        <th>Оплата (руб.)</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody id="routes-list">
                    <!-- Данные будут добавлены через JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Вкладка Водители -->
        <div class="tab-content" id="drivers">
            <h2>Управление водителями</h2>
            <form id="driver-form">
                <input type="hidden" id="driver-id">
                <div class="form-group">
                    <label for="driver-lastname">Фамилия</label>
                    <input type="text" id="driver-lastname" required>
                </div>
                <div class="form-group">
                    <label for="driver-firstname">Имя</label>
                    <input type="text" id="driver-firstname" required>
                </div>
                <div class="form-group">
                    <label for="driver-middlename">Отчество</label>
                    <input type="text" id="driver-middlename">
                </div>
                <div class="form-group">
                    <label for="driver-experience">Стаж (лет)</label>
                    <input type="number" id="driver-experience" min="0" required>
                </div>
                <button type="submit" id="driver-submit">Добавить водителя</button>
                <button type="button" id="driver-cancel" style="display: none; background-color: #95a5a6;">Отмена</button>
            </form>

            <table id="drivers-table">
                <thead>
                    <tr>
                        <th>Код</th>
                        <th>Фамилия</th>
                        <th>Имя</th>
                        <th>Отчество</th>
                        <th>Стаж (лет)</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody id="drivers-list">
                    <!-- Данные будут добавлены через JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Вкладка Перевозки -->
        <div class="tab-content" id="shipments">
            <h2>Учет выполненных перевозок</h2>
            <form id="shipment-form">
                <input type="hidden" id="shipment-id">
                <div class="form-group">
                    <label for="shipment-route">Маршрут</label>
                    <select id="shipment-route" required>
                        <option value="">Выберите маршрут</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="shipment-driver">Водитель</label>
                    <select id="shipment-driver" required>
                        <option value="">Выберите водителя</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="shipment-start">Дата отправки</label>
                    <input type="date" id="shipment-start" required>
                </div>
                <div class="form-group">
                    <label for="shipment-end">Дата возвращения</label>
                    <input type="date" id="shipment-end" required>
                </div>
                <div class="form-group">
                    <label for="shipment-bonus">Премия (руб.)</label>
                    <input type="number" id="shipment-bonus" min="0" value="0">
                </div>
                <button type="submit" id="shipment-submit">Добавить перевозку</button>
                <button type="button" id="shipment-cancel" style="display: none; background-color: #95a5a6;">Отмена</button>
            </form>

            <table id="shipments-table">
                <thead>
                    <tr>
                        <th>Код</th>
                        <th>Маршрут</th>
                        <th>Водитель</th>
                        <th>Дата отправки</th>
                        <th>Дата возвращения</th>
                        <th>Оплата</th>
                        <th>Премия</th>
                        <th>Итого</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody id="shipments-list">
                    <!-- Данные будут добавлены через JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Новая вкладка Заказ авто -->
        <div class="tab-content" id="order-bus">
            <h2>Заказ автобуса</h2>
            <div class="bus-catalog">
                <div class="bus-slider">
                    <div class="bus-slides">
                        <!-- Слайды будут добавлены через JavaScript -->
                    </div>
                    <div class="slider-controls">
                        <!-- Точки для навигации будут добавлены через JavaScript -->
                    </div>
                </div>
                
                <div class="order-form">
                    <h3>Оформление заказа</h3>
                    <form id="bus-order-form">
                        <div class="form-group">
                            <label for="bus-model">Выбранная модель</label>
                            <input type="text" id="bus-model" readonly>
                        </div>
                        <div class="form-group">
                            <label for="customer-name">Ваше имя</label>
                            <input type="text" id="customer-name" required>
                        </div>
                        <div class="form-group">
                            <label for="customer-phone">Телефон</label>
                            <input type="tel" id="customer-phone" required>
                        </div>
                        <div class="form-group">
                            <label for="order-date">Дата заказа</label>
                            <input type="date" id="order-date" required>
                        </div>
                        <div class="form-group">
                            <label for="rental-days">Количество дней аренды</label>
                            <input type="number" id="rental-days" min="1" value="1" required>
                        </div>
                        <div class="form-group">
                            <label for="total-cost">Общая стоимость</label>
                            <input type="text" id="total-cost" readonly>
                        </div>
                        <button type="submit">Заказать</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Вкладка Отчеты -->
        <div class="tab-content" id="reports">
            <h2>Отчеты и аналитика</h2>
            <div class="form-group">
                <label for="report-period">Период отчета</label>
                <select id="report-period">
                    <option value="all">За все время</option>
                    <option value="month">За последний месяц</option>
                    <option value="quarter">За последний квартал</option>
                    <option value="year">За последний год</option>
                </select>
            </div>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-label">Общий пробег</div>
                    <div class="stat-value" id="report-distance">0 км</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Общая оплата</div>
                    <div class="stat-value" id="report-payment">0 руб.</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Выплачено премий</div>
                    <div class="stat-value" id="report-bonus">0 руб.</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Средняя оплата за км</div>
                    <div class="stat-value" id="report-per-km">0 руб.</div>
                </div>
            </div>

            <h3>Топ водителей по заработку</h3>
            <table id="top-drivers-table">
                <thead>
                    <tr>
                        <th>Водитель</th>
                        <th>Количество перевозок</th>
                        <th>Общий заработок</th>
                    </tr>
                </thead>
                <tbody id="top-drivers-list">
                    <!-- Данные будут добавлены через JavaScript -->
                </tbody>
            </table>
        </div>

        <div class="notification" id="notification"></div>
    </div>

    <script>
        // Данные приложения
        let routes = JSON.parse(localStorage.getItem('routes')) || [];
        let drivers = JSON.parse(localStorage.getItem('drivers')) || [];
        let shipments = JSON.parse(localStorage.getItem('shipments')) || [];

        // Данные для автобусов
        const buses = [
            {
                id: 1,
                name: "Mercedes Sprinter",
                image: "https://avatars.mds.yandex.net/get-altay/10879408/2a00000190bb5df5274c13d3ff3c8f43a6b6/XXL_height",
                capacity: "20 пассажиров",
                fuel: "Дизель",
                consumption: "12 л/100км",
                price: 5000,
                description: "Комфортабельный автобус для городских и междугородних перевозок."
            },
            {
                id: 2,
                name: "Volkswagen Crafter",
                image: "https://avatars.mds.yandex.net/i?id=71f142a1199529d4f76566bac53ed3de_l-5233382-images-thumbs&n=13",
                capacity: "18 пассажиров",
                fuel: "Дизель",
                consumption: "11 л/100км",
                price: 4500,
                description: "Надежный и экономичный автобус для перевозки пассажиров."
            },
            {
                id: 3,
                name: "Ford Transit",
                image: "https://delovoy-kirov.ru/files/media/companymedia/69618/prev/47605.jpg",
                capacity: "16 пассажиров",
                fuel: "Дизель",
                consumption: "10 л/100км",
                price: 4000,
                description: "Практичный автобус для бизнес-перевозок и туризма."
            },
            {
                id: 4,
                name: "Iveco Daily",
                image: "https://auto-elektric.ru/wp-content/uploads/2019/06/2016-Iveco-Daily_01.jpg",
                capacity: "22 пассажира",
                fuel: "Дизель",
                consumption: "13 л/100км",
                price: 5500,
                description: "Вместительный автобус для групповых поездок и экскурсий."
            }
        ];

        // Сохранение данных в localStorage
        function saveData() {
            localStorage.setItem('routes', JSON.stringify(routes));
            localStorage.setItem('drivers', JSON.stringify(drivers));
            localStorage.setItem('shipments', JSON.stringify(shipments));
            updateStats();
        }

        // Обновление статистики
        function updateStats() {
            document.getElementById('total-routes').textContent = routes.length;
            document.getElementById('total-drivers').textContent = drivers.length;
            document.getElementById('total-shipments').textContent = shipments.length;
            
            let totalPayments = shipments.reduce((sum, shipment) => {
                let route = routes.find(r => r.id === shipment.routeId);
                return sum + (route ? route.payment : 0) + (shipment.bonus || 0);
            }, 0);
            
            document.getElementById('total-payments').textContent = totalPayments.toLocaleString() + ' руб.';
        }

        // Уведомления
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.backgroundColor = type === 'success' ? '#2ecc71' : '#e74c3c';
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Переключение вкладок
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Убираем активный класс у всех вкладок и контента
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Добавляем активный класс текущей вкладке и контенту
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
                
                // Обновляем данные при переключении на вкладку отчетов
                if (tab.dataset.tab === 'reports') {
                    updateReports();
                }
                
                // Обновляем данные при переключении на вкладку заказа авто
                if (tab.dataset.tab === 'order-bus') {
                    initBusSlider();
                }
            });
        });

        // Инициализация слайдера автобусов
        function initBusSlider() {
            const busSlides = document.querySelector('.bus-slides');
            const sliderControls = document.querySelector('.slider-controls');
            
            // Очищаем слайды и контролы
            busSlides.innerHTML = '';
            sliderControls.innerHTML = '';
            
            // Создаем слайды для каждого автобуса
            buses.forEach((bus, index) => {
                // Создаем слайд
                const slide = document.createElement('div');
                slide.className = 'bus-slide';
                slide.innerHTML = `
                    <div class="bus-image-container">
                        <img src="${bus.image}" alt="${bus.name}" class="bus-image">
                    </div>
                    <div class="bus-name">${bus.name}</div>
                    <div class="bus-specs">
                        <div class="bus-spec"><span>Вместимость:</span> <span>${bus.capacity}</span></div>
                        <div class="bus-spec"><span>Топливо:</span> <span>${bus.fuel}</span></div>
                        <div class="bus-spec"><span>Расход:</span> <span>${bus.consumption}</span></div>
                    </div>
                    <div class="bus-description">${bus.description}</div>
                    <div class="bus-price">${bus.price.toLocaleString()} руб./день</div>
                `;
                busSlides.appendChild(slide);
                
                // Создаем точку для навигации
                const dot = document.createElement('div');
                dot.className = `slider-dot ${index === 0 ? 'active' : ''}`;
                dot.dataset.index = index;
                dot.addEventListener('click', () => {
                    goToSlide(index);
                });
                sliderControls.appendChild(dot);
            });
            
            // Устанавливаем текущий слайд
            currentSlide = 0;
            updateBusOrderForm();
            
            // Добавляем обработчики свайпа
            let startX = 0;
            let endX = 0;
            
            busSlides.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
            });
            
            busSlides.addEventListener('touchmove', (e) => {
                endX = e.touches[0].clientX;
            });
            
            busSlides.addEventListener('touchend', () => {
                const diff = startX - endX;
                if (Math.abs(diff) > 50) { // Минимальное расстояние для свайпа
                    if (diff > 0) {
                        nextSlide();
                    } else {
                        prevSlide();
                    }
                }
            });
            
            // Добавляем обработчики для мыши
            busSlides.addEventListener('mousedown', (e) => {
                startX = e.clientX;
                busSlides.addEventListener('mousemove', handleMouseMove);
                busSlides.addEventListener('mouseup', handleMouseUp);
                busSlides.addEventListener('mouseleave', handleMouseUp);
            });
            
            function handleMouseMove(e) {
                endX = e.clientX;
            }
            
            function handleMouseUp() {
                const diff = startX - endX;
                if (Math.abs(diff) > 50) { // Минимальное расстояние для свайпа
                    if (diff > 0) {
                        nextSlide();
                    } else {
                        prevSlide();
                    }
                }
                busSlides.removeEventListener('mousemove', handleMouseMove);
                busSlides.removeEventListener('mouseup', handleMouseUp);
                busSlides.removeEventListener('mouseleave', handleMouseUp);
            }
        }
        
        let currentSlide = 0;
        
        function goToSlide(index) {
            const busSlides = document.querySelector('.bus-slides');
            const dots = document.querySelectorAll('.slider-dot');
            
            currentSlide = index;
            busSlides.style.transform = `translateX(-${index * 100}%)`;
            
            // Обновляем активную точку
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
            
            // Обновляем форму заказа
            updateBusOrderForm();
        }
        
        function nextSlide() {
            const nextIndex = (currentSlide + 1) % buses.length;
            goToSlide(nextIndex);
        }
        
        function prevSlide() {
            const prevIndex = (currentSlide - 1 + buses.length) % buses.length;
            goToSlide(prevIndex);
        }
        
        // Обновление формы заказа автобуса
        function updateBusOrderForm() {
            const currentBus = buses[currentSlide];
            const rentalDaysInput = document.getElementById('rental-days');
            const totalCostInput = document.getElementById('total-cost');
            
            document.getElementById('bus-model').value = currentBus.name;
            
            // Обновляем общую стоимость
            function updateTotalCost() {
                const days = parseInt(rentalDaysInput.value) || 1;
                const totalCost = currentBus.price * days;
                totalCostInput.value = totalCost.toLocaleString() + ' руб.';
            }
            
            rentalDaysInput.addEventListener('input', updateTotalCost);
            updateTotalCost();
        }
        
        // Обработка формы заказа автобуса
        document.getElementById('bus-order-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const currentBus = buses[currentSlide];
            const customerName = document.getElementById('customer-name').value;
            const customerPhone = document.getElementById('customer-phone').value;
            const orderDate = document.getElementById('order-date').value;
            const rentalDays = parseInt(document.getElementById('rental-days').value);
            const totalCost = currentBus.price * rentalDays;
            
            // Здесь можно добавить логику отправки заказа
            showNotification(`Заказ на автобус "${currentBus.name}" оформлен! С вами свяжутся по телефону ${customerPhone}.`);
            
            // Очищаем форму
            this.reset();
            updateBusOrderForm();
        });

        // Маршруты
        const routeForm = document.getElementById('route-form');
        const routesList = document.getElementById('routes-list');
        
        function renderRoutes() {
            routesList.innerHTML = '';
            routes.forEach(route => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${route.id}</td>
                    <td>${route.name}</td>
                    <td>${route.distance}</td>
                    <td>${route.days}</td>
                    <td>${route.payment}</td>
                    <td class="actions">
                        <button class="btn-edit" onclick="editRoute(${route.id})">Редактировать</button>
                        <button class="btn-delete" onclick="deleteRoute(${route.id})">Удалить</button>
                    </td>
                `;
                routesList.appendChild(row);
            });
            
            // Обновляем список маршрутов в форме перевозок
            const shipmentRouteSelect = document.getElementById('shipment-route');
            shipmentRouteSelect.innerHTML = '<option value="">Выберите маршрут</option>';
            routes.forEach(route => {
                const option = document.createElement('option');
                option.value = route.id;
                option.textContent = `${route.name} (${route.distance} км)`;
                shipmentRouteSelect.appendChild(option);
            });
            
            saveData();
        }
        
        routeForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const routeId = document.getElementById('route-id').value;
            const name = document.getElementById('route-name').value;
            const distance = parseInt(document.getElementById('route-distance').value);
            const days = parseInt(document.getElementById('route-days').value);
            const payment = parseInt(document.getElementById('route-payment').value);
            
            if (routeId) {
                // Редактирование существующего маршрута
                const index = routes.findIndex(r => r.id == routeId);
                if (index !== -1) {
                    routes[index] = { id: parseInt(routeId), name, distance, days, payment };
                    showNotification('Маршрут обновлен');
                }
            } else {
                // Добавление нового маршрута
                const id = routes.length > 0 ? Math.max(...routes.map(r => r.id)) + 1 : 1;
                routes.push({ id, name, distance, days, payment });
                showNotification('Маршрут добавлен');
            }
            
            routeForm.reset();
            document.getElementById('route-id').value = '';
            document.getElementById('route-cancel').style.display = 'none';
            renderRoutes();
        });
        
        document.getElementById('route-cancel').addEventListener('click', function() {
            routeForm.reset();
            document.getElementById('route-id').value = '';
            this.style.display = 'none';
        });
        
        function editRoute(id) {
            const route = routes.find(r => r.id === id);
            if (route) {
                document.getElementById('route-id').value = route.id;
                document.getElementById('route-name').value = route.name;
                document.getElementById('route-distance').value = route.distance;
                document.getElementById('route-days').value = route.days;
                document.getElementById('route-payment').value = route.payment;
                document.getElementById('route-cancel').style.display = 'inline-block';
            }
        }
        
        function deleteRoute(id) {
            if (confirm('Вы уверены, что хотите удалить этот маршрут?')) {
                routes = routes.filter(r => r.id !== id);
                // Также удаляем связанные перевозки
                shipments = shipments.filter(s => s.routeId !== id);
                showNotification('Маршрут удален');
                renderRoutes();
                renderShipments();
            }
        }

        // Водители
        const driverForm = document.getElementById('driver-form');
        const driversList = document.getElementById('drivers-list');
        
        function renderDrivers() {
            driversList.innerHTML = '';
            drivers.forEach(driver => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${driver.id}</td>
                    <td>${driver.lastName}</td>
                    <td>${driver.firstName}</td>
                    <td>${driver.middleName || '-'}</td>
                    <td>${driver.experience}</td>
                    <td class="actions">
                        <button class="btn-edit" onclick="editDriver(${driver.id})">Редактировать</button>
                        <button class="btn-delete" onclick="deleteDriver(${driver.id})">Удалить</button>
                    </td>
                `;
                driversList.appendChild(row);
            });
            
            // Обновляем список водителей в форме перевозок
            const shipmentDriverSelect = document.getElementById('shipment-driver');
            shipmentDriverSelect.innerHTML = '<option value="">Выберите водителя</option>';
            drivers.forEach(driver => {
                const option = document.createElement('option');
                option.value = driver.id;
                option.textContent = `${driver.lastName} ${driver.firstName} ${driver.middleName || ''}`;
                shipmentDriverSelect.appendChild(option);
            });
            
            saveData();
        }
        
        driverForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const driverId = document.getElementById('driver-id').value;
            const lastName = document.getElementById('driver-lastname').value;
            const firstName = document.getElementById('driver-firstname').value;
            const middleName = document.getElementById('driver-middlename').value;
            const experience = parseInt(document.getElementById('driver-experience').value);
            
            if (driverId) {
                // Редактирование существующего водителя
                const index = drivers.findIndex(d => d.id == driverId);
                if (index !== -1) {
                    drivers[index] = { id: parseInt(driverId), lastName, firstName, middleName, experience };
                    showNotification('Данные водителя обновлены');
                }
            } else {
                // Добавление нового водителя
                const id = drivers.length > 0 ? Math.max(...drivers.map(d => d.id)) + 1 : 1;
                drivers.push({ id, lastName, firstName, middleName, experience });
                showNotification('Водитель добавлен');
            }
            
            driverForm.reset();
            document.getElementById('driver-id').value = '';
            document.getElementById('driver-cancel').style.display = 'none';
            renderDrivers();
        });
        
        document.getElementById('driver-cancel').addEventListener('click', function() {
            driverForm.reset();
            document.getElementById('driver-id').value = '';
            this.style.display = 'none';
        });
        
        function editDriver(id) {
            const driver = drivers.find(d => d.id === id);
            if (driver) {
                document.getElementById('driver-id').value = driver.id;
                document.getElementById('driver-lastname').value = driver.lastName;
                document.getElementById('driver-firstname').value = driver.firstName;
                document.getElementById('driver-middlename').value = driver.middleName || '';
                document.getElementById('driver-experience').value = driver.experience;
                document.getElementById('driver-cancel').style.display = 'inline-block';
            }
        }
        
        function deleteDriver(id) {
            if (confirm('Вы уверены, что хотите удалить этого водителя?')) {
                drivers = drivers.filter(d => d.id !== id);
                // Также удаляем связанные перевозки
                shipments = shipments.filter(s => s.driverId !== id);
                showNotification('Водитель удален');
                renderDrivers();
                renderShipments();
            }
        }

        // Перевозки
        const shipmentForm = document.getElementById('shipment-form');
        const shipmentsList = document.getElementById('shipments-list');
        
        function renderShipments() {
            shipmentsList.innerHTML = '';
            shipments.forEach(shipment => {
                const route = routes.find(r => r.id === shipment.routeId);
                const driver = drivers.find(d => d.id === shipment.driverId);
                
                if (route && driver) {
                    const row = document.createElement('tr');
                    const totalPayment = route.payment + (shipment.bonus || 0);
                    
                    row.innerHTML = `
                        <td>${shipment.id}</td>
                        <td>${route.name}</td>
                        <td>${driver.lastName} ${driver.firstName} ${driver.middleName || ''}</td>
                        <td>${shipment.startDate}</td>
                        <td>${shipment.endDate}</td>
                        <td>${route.payment}</td>
                        <td>${shipment.bonus || 0}</td>
                        <td>${totalPayment}</td>
                        <td class="actions">
                            <button class="btn-edit" onclick="editShipment(${shipment.id})">Редактировать</button>
                            <button class="btn-delete" onclick="deleteShipment(${shipment.id})">Удалить</button>
                        </td>
                    `;
                    shipmentsList.appendChild(row);
                }
            });
            
            saveData();
        }
        
        shipmentForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const shipmentId = document.getElementById('shipment-id').value;
            const routeId = parseInt(document.getElementById('shipment-route').value);
            const driverId = parseInt(document.getElementById('shipment-driver').value);
            const startDate = document.getElementById('shipment-start').value;
            const endDate = document.getElementById('shipment-end').value;
            const bonus = parseInt(document.getElementById('shipment-bonus').value) || 0;
            
            if (shipmentId) {
                // Редактирование существующей перевозки
                const index = shipments.findIndex(s => s.id == shipmentId);
                if (index !== -1) {
                    shipments[index] = { id: parseInt(shipmentId), routeId, driverId, startDate, endDate, bonus };
                    showNotification('Данные перевозки обновлены');
                }
            } else {
                // Добавление новой перевозки
                const id = shipments.length > 0 ? Math.max(...shipments.map(s => s.id)) + 1 : 1;
                shipments.push({ id, routeId, driverId, startDate, endDate, bonus });
                showNotification('Перевозка добавлена');
            }
            
            shipmentForm.reset();
            document.getElementById('shipment-id').value = '';
            document.getElementById('shipment-cancel').style.display = 'none';
            renderShipments();
        });
        
        document.getElementById('shipment-cancel').addEventListener('click', function() {
            shipmentForm.reset();
            document.getElementById('shipment-id').value = '';
            this.style.display = 'none';
        });
        
        function editShipment(id) {
            const shipment = shipments.find(s => s.id === id);
            if (shipment) {
                document.getElementById('shipment-id').value = shipment.id;
                document.getElementById('shipment-route').value = shipment.routeId;
                document.getElementById('shipment-driver').value = shipment.driverId;
                document.getElementById('shipment-start').value = shipment.startDate;
                document.getElementById('shipment-end').value = shipment.endDate;
                document.getElementById('shipment-bonus').value = shipment.bonus || 0;
                document.getElementById('shipment-cancel').style.display = 'inline-block';
            }
        }
        
        function deleteShipment(id) {
            if (confirm('Вы уверены, что хотите удалить эту перевозку?')) {
                shipments = shipments.filter(s => s.id !== id);
                showNotification('Перевозка удалена');
                renderShipments();
            }
        }

        // Отчеты
        function updateReports() {
            // Общая статистика
            let totalDistance = 0;
            let totalPayment = 0;
            let totalBonus = 0;
            
            shipments.forEach(shipment => {
                const route = routes.find(r => r.id === shipment.routeId);
                if (route) {
                    totalDistance += route.distance;
                    totalPayment += route.payment;
                    totalBonus += shipment.bonus || 0;
                }
            });
            
            document.getElementById('report-distance').textContent = totalDistance.toLocaleString() + ' км';
            document.getElementById('report-payment').textContent = (totalPayment + totalBonus).toLocaleString() + ' руб.';
            document.getElementById('report-bonus').textContent = totalBonus.toLocaleString() + ' руб.';
            
            const perKm = totalDistance > 0 ? (totalPayment + totalBonus) / totalDistance : 0;
            document.getElementById('report-per-km').textContent = perKm.toFixed(2) + ' руб./км';
            
            // Топ водителей
            const driverEarnings = {};
            
            shipments.forEach(shipment => {
                const driver = drivers.find(d => d.id === shipment.driverId);
                const route = routes.find(r => r.id === shipment.routeId);
                
                if (driver && route) {
                    const driverName = `${driver.lastName} ${driver.firstName}`;
                    const earnings = route.payment + (shipment.bonus || 0);
                    
                    if (!driverEarnings[driverName]) {
                        driverEarnings[driverName] = {
                            count: 0,
                            total: 0
                        };
                    }
                    
                    driverEarnings[driverName].count++;
                    driverEarnings[driverName].total += earnings;
                }
            });
            
            // Сортировка водителей по заработку
            const sortedDrivers = Object.entries(driverEarnings)
                .sort((a, b) => b[1].total - a[1].total)
                .slice(0, 5); // Топ-5
            
            const topDriversList = document.getElementById('top-drivers-list');
            topDriversList.innerHTML = '';
            
            sortedDrivers.forEach(([driverName, data]) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${driverName}</td>
                    <td>${data.count}</td>
                    <td>${data.total.toLocaleString()} руб.</td>
                `;
                topDriversList.appendChild(row);
            });
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            renderRoutes();
            renderDrivers();
            renderShipments();
            updateReports();
            initBusSlider();
        });
    </script>
</body>

</html>
